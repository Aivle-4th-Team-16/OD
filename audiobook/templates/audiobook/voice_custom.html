{% extends 'audiobook/template.html' %}
{% load static %}

{% block title %}O :D - 성우 선택{% endblock %}
{% block style %}
<style>
    .card-custom {
        height: 200px;
        width: 120px;
    }

    .card-img-top {
        height: 200px; 
        object-fit: contain; 
    }

</style>
{% endblock %}
{% block content %}

<div class="row my-5">
    <h1 class="menu-font">성우 선택</h1>
</div>

<!-- 성우 검색 -->
<div class="container text-center">
    <div class="row mt-3 justify-content-end">
        <div class="col-6">
            <div class="input-group gap-4">
                <div class="col">
                    <input id="search-input" type="text" class="form-control rounded-start rounded-end" placeholder="듣고 싶은 목소리를 검색해보세요" aria-label="음성 입력" aria-describedby="basic-addon2">
                </div>
                <div class="input-group-append">
                    <button id="search-button" class="btn btn-outline-orange-400" type="button">검색</button>
                </div>
            </div>  
        </div>
    </div>
</div>

<!-- 서브 네비게이션 바 -->
{% include 'audiobook/voice_sub_navbar.html' %}


<div>
    <h2 class="fw-bold mt-4 mb-3">내 음성</h2>
    <div class="row justify-content-start">
        {% for voice in user_voices %}
        <div class="col-2 mb-3">
            <div id="voiceCard{{ voice.voice_id }}" class="card card-custom" style="cursor:pointer;">
                <img src="{{ voice.voice_image_path.url }}" class="card-img-top" alt="{{ voice.voice_name }}">
            </div>
        </div>
        {% endfor %}

        <!-- 음성 추가하기 -->
        <div class="col-2 mb-3">
            <div class="card card-custom">
                <div class="card-body d-flex justify-content-center align-items-center" style="height: 200px;">
                    <a href="{% url 'audiobook:voice_custom_upload' book.book_id%}" class="text-center">
                        <svg class="bi bi-plus-circle" fill="currentColor" width="48" height="48" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <h2 class="fw-bold mt-4 mb-3">다른 사람 음성</h2>
    <div class="row justify-content-start">
        {% for voice in public_voices %}
        <div class="col-2 mb-3">
            <div class="card card-custom">
                <img src="{{ voice.voice_image_path.url }}" class="card-img-top" alt="{{ voice.voice_name }}">
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- 여백 -->
<div class="row my-5"></div>

{% endblock %}
{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% for voice in user_voices %}
        var card = document.getElementById("voiceCard{{ voice.voice_id }}");
        card.addEventListener("click", function() {
            selectVoice('{{ voice.voice_id }}', '{{ voice.voice_name }}');
        });
        {% endfor %}
    
        // 기존의 selectVoice 함수
        function selectVoice(voiceId, voiceName) {
            document.cookie = "selectedVoiceId=" + voiceId + ";path=/";
            document.cookie = "selectedVoiceName=" + voiceName + ";path=/";
        }

        // 검색 버튼에 대한 이벤트 리스너 추가
        document.getElementById('search-button').addEventListener('click', function() {
            var searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
            // 현재 페이지 URL에 검색어를 추가한 후 페이지를 리로드
            window.location.href = `{% url 'audiobook:voice_custom' %}?search_term=${searchTerm}`;
        });
    });
</script>
{% endblock %}